#!/usr/bin/env bash
# -*- coding: utf-8 -*-

# make a new release on GitHub

set -e

git pull --all
lcm="$(git --no-pager log -n 1 --pretty=format:'%s')"
mrc="$(git --no-pager log -n 1 --pretty=format:'%H')"
orv="$(hub release | grep -o '0.0.\dr\d*' | head -n1)"
if [[ $orv = "" ]]; then
	nrv="0.0.0r1"
else
	nrv="${orv%r*}r$((${orv#*r} + 1))"
fi

echo "${lcm} ${nrv}"
hub release create -p -t "${mrc}" -m "${lcm}" $nrv
git pull
